<ng-template #tableTemplatePartial let-row>
  <td class="govuk-table__cell">
    <a [routerLink]="['.']"> {{ row.caseNumber }}</a>
  </td>
  <td class="govuk-table__cell">{{ row.courthouse }}</td>
  <td class="govuk-table__cell">{{ row.hearingDate }}</td>
  <td class="govuk-table__cell">{{ row.startTime }}</td>
  <td class="govuk-table__cell">{{ row.endTime }}</td>
  <td class="govuk-table__cell">{{ row.requestId }}</td>
  <td class="govuk-table__cell">{{ row.expiry }}</td>
</ng-template>

<h1 class="govuk-label-wrapper">
  <label class="govuk-label govuk-label--l" for="case-search">Your Audio</label>
</h1>
<ng-container *ngIf="data$ | async as data; else loading">
  <app-tabs>
    <div *tab="'Current'">
      <p *ngIf="!data.inProgessRows.length && !data.completedRows.length" class="govuk-body">
        There are no audio files in progress or ready
      </p>

      <ng-container *ngIf="data.inProgessRows.length">
        <h2 class="govuk-heading-m">In Progress</h2>
        <app-data-table id="inProgressTable" [rows]="data.inProgessRows" [columns]="columns" [pagination]="false">
          <ng-template [tableRowTemplate] let-row>
            <!-- Partial template for duplicated cells -->
            <ng-container *ngTemplateOutlet="tableTemplatePartial; context: { $implicit: row }"></ng-container>

            <td class="govuk-table__cell">
              <strong class="govuk-tag" [ngClass]="row.status === 'FAILED' ? 'govuk-tag--red' : 'govuk-tag--yellow'">
                {{ row.status }}
              </strong>
            </td>
          </ng-template>
        </app-data-table>
      </ng-container>

      <ng-container *ngIf="data.completedRows.length">
        <h2 class="govuk-heading-m">Ready</h2>
        <div class="govuk-hint">Select to apply actions</div>
        <app-data-table
          id="readyTable"
          [rows]="data.completedRows"
          [columns]="readyColumns"
          [rowSelectable]="true"
          [pageLimit]="15"
        >
          <ng-template [tableRowTemplate] let-row>
            <td class="govuk-table__cell">
              <span unreadIcon [class.unread]="!row.last_accessed_ts" *ngIf="!row.last_accessed_ts"> </span>
            </td>
            <!-- Partial template for duplicated cells -->
            <ng-container *ngTemplateOutlet="tableTemplatePartial; context: { $implicit: row }"></ng-container>

            <td class="govuk-table__cell">
              <div class="status-cell">
                <strong class="govuk-tag govuk-tag--green"> READY </strong>
                <a [routerLink]="['/audios/', row.requestId]">View</a>
              </div>
            </td>
          </ng-template>
        </app-data-table>
      </ng-container>
    </div>

    <div *tab="'Expired'">
      <ng-container *ngIf="data.expiredRows.length">
        <h2 class="govuk-heading-m">Expired</h2>
        <app-data-table id="expiredTable" [rows]="data.expiredRows" [columns]="columns">
          <ng-template [tableRowTemplate] let-row>
            <!-- Partial template for duplicated cells -->
            <ng-container *ngTemplateOutlet="tableTemplatePartial; context: { $implicit: row }"></ng-container>

            <td class="govuk-table__cell">
              <div class="status-cell">
                <strong class="govuk-tag govuk-tag--grey"> EXPIRED </strong>
              </div>
            </td>
          </ng-template>
        </app-data-table>
      </ng-container>
    </div>
  </app-tabs>
</ng-container>
<ng-template #loading>
  <app-loading text="Loading audio requests..."></app-loading>
</ng-template>
