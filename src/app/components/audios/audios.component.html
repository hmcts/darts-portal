<h1 class="govuk-label-wrapper">
  <label class="govuk-label govuk-label--l" for="case-search">Your Audio</label>
  <span id="notifications" *ngIf="unreadCount$ | async as unreadCount" class="moj-notification-badge">{{
    unreadCount
  }}</span>
</h1>
<ng-container *ngIf="data$ | async as data; else loading">
  <app-tabs>
    <div *tab="'Current'">
      <p *ngIf="!data.inProgessRows.length && !data.completedRows.length">
        There are no audio files in progress or ready
      </p>

      <pre>{{ data.completedRows | json }}</pre>

      <ng-container *ngIf="data.inProgessRows.length">
        <h2 class="govuk-heading-m">In Progress</h2>
        <app-data-table [rows]="data.inProgessRows" [columns]="columns" [pagination]="false">
          <ng-template [tableRowTemplate] let-row>
            <td class="govuk-table__cell">
              <a [routerLink]="['.']">{{ row.caseNumber }}</a>
            </td>
            <td class="govuk-table__cell">{{ row.courthouse }}</td>
            <td class="govuk-table__cell">{{ row.hearingDate }}</td>
            <td class="govuk-table__cell">{{ row.startTime }}</td>
            <td class="govuk-table__cell">{{ row.endTime }}</td>
            <td class="govuk-table__cell">{{ row.requestId }}</td>
            <td class="govuk-table__cell">{{ row.expiry }}</td>
            <td class="govuk-table__cell">
              <strong *ngIf="row.status === 'FAILED'" class="govuk-tag govuk-tag--red"> {{ row.status }} </strong>
              <strong *ngIf="row.status !== 'FAILED'" class="govuk-tag govuk-tag--yellow"> {{ row.status }} </strong>
            </td>
          </ng-template>
        </app-data-table>
      </ng-container>

      <ng-container *ngIf="data.completedRows.length">
        <h2 class="govuk-heading-m">Ready</h2>
        <div class="govuk-hint">Select to apply actions</div>
        <app-data-table [rows]="data.completedRows" [columns]="columns">
          <ng-template [tableRowTemplate] let-row>
            <td class="govuk-table__cell">
              <span unreadIcon [class.unread]='!row.last_accessed_ts' *ngIf="!row.last_accessed_ts"> </span>
              <a [routerLink]="['.']">{{ row.caseNumber }}</a>
            </td>
            <td class="govuk-table__cell">{{ row.courthouse }}</td>
            <td class="govuk-table__cell">{{ row.hearingDate }}</td>
            <td class="govuk-table__cell">{{ row.startTime }}</td>
            <td class="govuk-table__cell">{{ row.endTime }}</td>
            <td class="govuk-table__cell">{{ row.requestId }}</td>
            <td class="govuk-table__cell">{{ row.expiry }}</td>
            <td class="govuk-table__cell">
              <div class="status-cell">
                <strong class="govuk-tag govuk-tag--green"> READY </strong>
                <a [routerLink]="['/audios/', row.requestId]">View</a>
              </div>
            </td>
          </ng-template>
        </app-data-table>
      </ng-container>
    </div>
    <div *tab="'Expired'">
      <ng-container *ngIf="false">
        <app-data-table [rows]="data.expiredRows" [columns]="columns"></app-data-table>
      </ng-container>
    </div>
  </app-tabs>
</ng-container>
<ng-template #loading>
  <app-loading text="Loading audio requests..."></app-loading>
</ng-template>
