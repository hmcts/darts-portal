<ng-template #tableTemplatePartial let-row>
  <td class="govuk-table__cell">{{ row.caseNumber }}</td>
  <td class="govuk-table__cell">{{ row.courthouseName }}</td>
  <td class="govuk-table__cell">{{ row.hearingDate | luxonDate: 'dd MMM yyyy' }}</td>
  <td class="govuk-table__cell">{{ row.transcriptionType }}</td>
  <td class="govuk-table__cell">{{ row.requestedTs | luxonDate: 'dd MMM yyyy HH:mm' }}</td>
  <td class="govuk-table__cell">
    <strong class="govuk-tag" [ngClass]="transcriptStatusClassMap[row.status]">{{ row.status }}</strong>
  </td>
  <td class="govuk-table__cell">
    <span [ngClass]="row.urgency.description === 'Overnight' ? 'moj-badge moj-badge--red' : ''">{{
      row.urgency.description
    }}</span>
  </td>
</ng-template>

@if (isDeleting) {
  <app-delete [numberOfItems]="selectedRequests.length" (confirm)="onDeleteConfirmed()" (cancel)="onDeleteCancelled()">
    <app-data-table id="deletionTable" [rows]="selectedRequests" [columns]="deleteColumns">
      <ng-template [tableRowTemplate]="selectedRequests" let-row>
        <ng-container *ngTemplateOutlet="tableTemplatePartial; context: { $implicit: row }"></ng-container>
      </ng-template>
    </app-data-table>
  </app-delete>
} @else {
  <app-govuk-heading>Your transcripts</app-govuk-heading>

  @if (isApprover && (isRequester || isJudge)) {
    <app-tabs>
      <div *tab="'Transcript requests'">
        <ng-template [ngTemplateOutlet]="RequesterTemplate"></ng-template>
      </div>
      <div *tab="'Transcript requests to review'">
        <ng-template [ngTemplateOutlet]="ApproverTemplate"></ng-template>
      </div>
    </app-tabs>
  } @else if (isApprover) {
    <ng-template [ngTemplateOutlet]="ApproverTemplate"></ng-template>
  } @else if (isApprover || isRequester || isJudge) {
    <ng-template [ngTemplateOutlet]="RequesterTemplate"></ng-template>
  }
}

<ng-template #RequesterTemplate>
  @if (requesterRequests$ | async; as vm) {
    @if (!vm.inProgressRequests.length && !vm.completedRequests.length) {
      <p id="no-requests-message" class="govuk-body">There are no transcription requests in progress or ready</p>
    }

    @if (vm.inProgressRequests.length) {
      <h2 class="govuk-heading-m">In Progress</h2>
      <app-data-table
        id="in-progress-table"
        [rows]="vm.inProgressRequests"
        [columns]="columns"
        [pagination]="true"
        [pageLimit]="15"
      >
        <ng-template [tableRowTemplate]="vm.inProgressRequests" let-row>
          <ng-container *ngTemplateOutlet="tableTemplatePartial; context: { $implicit: row }"></ng-container>
        </ng-template>
      </app-data-table>
    }
    @if (vm.completedRequests.length) {
      <h2 class="govuk-heading-m">Ready</h2>
      <div class="action-container">
        <div class="govuk-hint">Select to apply actions</div>
        <button id="delete-button" class="govuk-button govuk-button--secondary" (click)="onDeleteClicked()">
          Remove transcript request
        </button>
      </div>
      <app-data-table
        id="ready-table"
        [rows]="vm.completedRequests"
        [columns]="readyColumns"
        [pagination]="true"
        [pageLimit]="15"
        [rowSelectable]="true"
        (rowSelect)="selectedRequests = $event"
      >
        <ng-template [tableRowTemplate]="vm.completedRequests" let-row>
          <ng-container *ngTemplateOutlet="tableTemplatePartial; context: { $implicit: row }"></ng-container>
          <td class="govuk-table__cell">
            <a class="govuk-link" [routerLink]="['transcripts', row.transcriptionId]">View</a>
          </td>
        </ng-template>
      </app-data-table>
    }
  } @else {
    <app-loading text="Loading transcription requests..." />
  }
</ng-template>

<ng-template #ApproverTemplate>
  @if (approverRequests$ | async; as approverRequests) {
    @if (!approverRequests.length) {
      <p id="no-requests-message" class="govuk-body">There are no transcription requests to review</p>
    }
    @if (approverRequests.length) {
      <h2 class="govuk-heading-m">Requests to approve or reject</h2>

      <app-data-table
        id="approver-table"
        [rows]="approverRequests"
        [columns]="approverColumns"
        [pagination]="true"
        [pageLimit]="15"
      >
        <ng-template [tableRowTemplate]="approverRequests" let-row>
          <td class="govuk-table__cell">{{ row.caseNumber }}</td>
          <td class="govuk-table__cell">{{ row.courthouseName }}</td>
          <td class="govuk-table__cell">{{ row.hearingDate | luxonDate: 'dd MMM yyyy' }}</td>
          <td class="govuk-table__cell">{{ row.transcriptionType }}</td>
          <td class="govuk-table__cell">{{ row.requestedTs | luxonDate: 'dd MMM yyyy HH:mm' }}</td>
          <td class="govuk-table__cell">{{ row.transcriptionId }}</td>
          <td class="govuk-table__cell">
            <span [ngClass]="row.urgency.description === 'Overnight' ? 'moj-badge moj-badge--red' : ''">{{
              row.urgency.description
            }}</span>
          </td>
          <td class="govuk-table__cell">
            <a class="govuk-link" [routerLink]="['approve-transcript', row.transcriptionId]">View</a>
          </td>
        </ng-template>
      </app-data-table>
    }
  } @else {
    <app-loading text="Loading transcriptions awaiting approval..." />
  }
</ng-template>
