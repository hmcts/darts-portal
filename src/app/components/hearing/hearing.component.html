<ng-container *ngIf="data$ | async as vm; else loading">
  <!-- Breadcrumbs -->
  <div [hidden]="state !== 'Default'" class="govuk-breadcrumbs">
    <ol class="govuk-breadcrumbs__list">
      <li class="govuk-breadcrumbs__list-item">
        <a routerLink="../.." class="govuk-breadcrumbs__link">{{ vm.case.case_number }}</a>
      </li>
      <li class="govuk-breadcrumbs__list-item">
        <a [routerLink]="['/case/', vm.case.case_id, 'hearing', vm.hearing?.id]" class="govuk-breadcrumbs__link">{{
          vm.hearing?.date | date : 'd MMM y'
        }}</a>
      </li>
    </ol>
  </div>

  <!-- Back Button -->
  <a href="#" *ngIf="state === 'OrderSummary'" (click)="onBack($event)" class="govuk-back-link">Back</a>

  <!-- Reporting Restriction Banner -->
  <app-reporting-restriction
    *ngIf="vm.case.reporting_restriction"
    [reportingRestriction]="vm.case.reporting_restriction"
    [class.pad-top]="state === 'OrderConfirmation'"
  ></app-reporting-restriction>

  <!-- Hearing Screen -->
  <div [hidden]="state !== 'Default'">
    <app-hearing-file [case]="vm.case" [hearing]="vm.hearing"></app-hearing-file>

    <h2 id="events-audio-heading" class="govuk-heading-m">Events and audio recordings</h2>

    <app-request-playback-audio
      [hearing]="vm.hearing!"
      [requestAudioTimes]="requestAudioTimes"
      [userState]="userState"
      (audioRequest)="onAudioRequest($event)"
    ></app-request-playback-audio>

    <!-- Events & Audio Table-->
    <app-events-and-audio
      [audio]="vm.audios"
      [events]="vm.events"
      (eventsSelect)="onEventsSelected($event)"
    ></app-events-and-audio>
  </div>

  <!-- Summary / Confirmation Screen -->
  <div [hidden]="state !== 'OrderConfirmation' && state !== 'OrderSummary'" class="order-confirmation">
    <app-order-confirmation
      [case]="vm.case"
      [hearing]="vm.hearing"
      [audioRequest]="requestObject"
      [requestId]="requestId"
      [state]="state"
      [userProfile]="userState"
      (stateChange)="onStateChanged($event)"
      (orderConfirm)="onOrderConfirm($event)"
    ></app-order-confirmation>
  </div>
</ng-container>

<ng-template #loading>
  <app-loading text="Loading hearing details..."></app-loading>
</ng-template>
