@let courthouses = courthouses$ | async;
@let isAdvancedSearch = transcriptService.isAdvancedSearch;
@let formValues = transcriptService.searchFormValues();
@let results = transcriptService.searchResults();
@let completedResults = transcriptService.completedSearchResults();
@let loading = isLoading();
@let tab = transcriptService.tab();

<app-validation-error-summary [errors]="errors" />
<app-govuk-heading size="xl">Transcripts</app-govuk-heading>

@if (courthouses) {
  <app-tabs (tabChange)="onTabChanged($event.name)" [default]="tab">
    <div *tab="'Requests'">
      <app-govuk-heading>Transcript requests</app-govuk-heading>

      <app-search-transcripts-form
        [courthouses]="courthouses"
        [formValues]="formValues"
        (search)="onSearch($event)"
        (errors)="errors = $event"
        (clear)="clearSearch()"
        [(isAdvancedSearch)]="isAdvancedSearch"
      />

      @if (results) {
        <app-search-transcripts-results [results]="results" />
      }

      @if (loading) {
        <app-loading text="Searching transcript requests..." />
      }
    </div>

    <div *tab="'Completed transcripts'">
      <app-govuk-heading>Completed transcripts</app-govuk-heading>

      <app-search-transcripts-form
        [courthouses]="courthouses"
        [isCompletedTranscriptSearch]="true"
        [formValues]="formValues"
        (search)="onSearch($event)"
        (errors)="errors = $event"
        (clear)="clearSearch()"
        [(isAdvancedSearch)]="isAdvancedSearch"
      />

      @if (completedResults) {
        <app-search-completed-transcripts-results [results]="completedResults" />
      }

      @if (loading) {
        <app-loading text="Searching completed transcripts..." />
      }
    </div>
  </app-tabs>
}
